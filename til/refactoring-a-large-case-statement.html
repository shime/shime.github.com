<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="//gmpg.org/xfn/11" rel="profile">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/monokai.css?1612619160404793000">
  <link rel="stylesheet" href="/public/css/style.css?1612619160404793000">

  <link rel="icon" sizes="16x16 32x32 64x64" href="/public/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/public/favicon-196.png">
<link rel="icon" type="image/png" sizes="160x160" href="/public/favicon-160.png">
<link rel="icon" type="image/png" sizes="128x128" href="/public/favicon-128.png">
<link rel="icon" type="image/png" sizes="96x96" href="/public/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/public/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16.png">
<link rel="apple-touch-icon" href="/public/favicon-57.png">
<link rel="apple-touch-icon" sizes="180x180" href="/public/favicon-180.png">
<link rel="apple-touch-icon" sizes="152x152" href="/public/favicon-152.png">
<link rel="apple-touch-icon" sizes="144x144" href="/public/favicon-144.png">
<link rel="apple-touch-icon" sizes="120x120" href="/public/favicon-120.png">
<link rel="apple-touch-icon" sizes="114x114" href="/public/favicon-114.png">
<link rel="apple-touch-icon" sizes="76x76" href="/public/favicon-76.png">
<link rel="apple-touch-icon" sizes="72x72" href="/public/favicon-72.png">
<link rel="apple-touch-icon" sizes="60x60" href="/public/favicon-60.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/public/favicon-144.png">
<meta name="msapplication-config" content="/public/browserconfig.xml">


  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Refactoring a large case statement" />
<meta name="author" content="Hrvoje Šimić" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I&#39;m currently building a gem for converting curl commands to something else, and one early problem I needed to deal with was parsing the curl command arguments." />
<meta property="og:description" content="I&#39;m currently building a gem for converting curl commands to something else, and one early problem I needed to deal with was parsing the curl command arguments." />
<link rel="canonical" href="http://shime.sh/til/refactoring-a-large-case-statement" />
<meta property="og:url" content="http://shime.sh/til/refactoring-a-large-case-statement" />
<meta property="og:site_name" content="Hrvoje Šimić" />
<meta property="og:image" content="http://shime.sh/public/social.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-03T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="http://shime.sh/public/social.png" />
<meta property="twitter:title" content="Refactoring a large case statement" />
<meta name="twitter:site" content="@shime_sh" />
<meta name="twitter:creator" content="@shime_sh" />
<script type="application/ld+json">
{"url":"http://shime.sh/til/refactoring-a-large-case-statement","image":"http://shime.sh/public/social.png","headline":"Refactoring a large case statement","dateModified":"2019-02-03T00:00:00+01:00","datePublished":"2019-02-03T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://shime.sh/til/refactoring-a-large-case-statement"},"description":"I&#39;m currently building a gem for converting curl commands to something else, and one early problem I needed to deal with was parsing the curl command arguments.","author":{"@type":"Person","name":"Hrvoje Šimić"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  
    <title> Refactoring a large case statement &middot; Hrvoje Šimić </title>
  

  <meta name="title" content="Refactoring a large case statement &middot; Hrvoje Šimić">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
  <script src="https://unpkg.com/time-ago@0.2.1/timeago.js"></script>
  <script src="https://unpkg.com/fetch-polyfill@0.8.2/fetch.js"></script>

  
</head>


  <body class="font-sans">
    <div class="lg:pt-16 lg:pb-32 p-6 relative">
      




<div class="relative flex justify-between items-start w-full z-20 md:justify-center self-center">
  <div class="flex items-center">
    <div class="flex flex-col">
      <a class="text-black font-bold text-xl no-underline font-extrabold self-start" href="/">Hrvoje Šimić</a>
      <a class="text-black font-bold no-underline font-extrabold my-1 self-start" href="https://twitter.com/shime_sh">@shime_sh</a>
      <ul class="hidden md:block list-reset tracking-wide">
        
        <li class="inline">
          
          <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-black" href='/articles/'>Articles</a>
          
        </li>
        
        <li class="inline">
          
          <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-black" href='/til/'>TIL</a>
          
        </li>
        
        <li class="inline">
          
          <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-black" href='/photography/'>Photography</a>
          
        </li>
        
        <li class="inline">
          
          <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-black" href='/reading/'>Reading list</a>
          
        </li>
        
      </ul>
    </div>
  </div>

  <div class="block md:hidden self-center">
    <button data-open-hamburger-menu="true">
      <svg height="32" width="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path fill="black" class="heroicon-ui" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
      </svg>
    </button>

    <button data-close-hamburger-menu="true" class="hidden">
      <svg fill="black" height="32" id="close" viewBox="0 0 32 32" width="32" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 8 L8 4 L16 12 L24 4 L28 8 L20 16 L28 24 L24 28 L16 20 L8 28 L4 24 L12 16 z"/>
      </svg>
    </button>
  </div>
</div>

<div class="hidden md:hidden fixed pin bg-white z-10 mt-32 pt-12" data-hamburger-menu="true">
  <ul class="list-reset tracking-wide flex flex-col items-center w-full">
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-grey no-underline uppercase" href='/articles/'>Articles</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-grey no-underline uppercase" href='/til/'>TIL</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-grey no-underline uppercase" href='/photography/'>Photography</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-grey no-underline uppercase" href='/reading/'>Reading list</a>
      
    </li>
    
  </ul>
</div>


      <div class="w-full flex justify-center text-lg mt-16 text-grey-darker font-light leading-normal">
        <div class="flex-col">
          <div class="max-w-full">
            

          </div>

          <div class="post max-w-full md:max-w-md">
            
            

            <div>
              <a class="no-underline uppercase text-sm" href="/til"> ← til </a>
            </div>

            <div class="mb-8">
              <h1>Refactoring a large case statement</h1>

              <div class="flex justify-between" data-nosnippet>
                
                  <div class="text-grey text-sm" data-js-time-ago>
                    February 3, 2019
                  </div>
                

                <div data-js-views-container class="hidden inline text-grey text-sm">
                  <span data-js-views>0</span> views
                </div>
              </div>

              <div class="flex my-2" data-nosnippet>
                
                  <span class="bg-grey-lightest py-1 px-2 text-center text-grey-dark mr-2 rounded text-sm">
                    ruby
                  </span>
                
              </div>
            </div>

            <p>I&#39;m currently building a gem for converting
curl commands to something else, and one early
problem I needed to deal with was parsing the 
curl command arguments.</p>

<p>The basic idea for a gem is to convert curl command to
a sweet looking hash that we can use to do
magical things. So when given:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>curl https://isrubydead.com/
</code></pre></div>
<p>Our program converts it to:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="p">{</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
  <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://isrubydead.com/&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>We&#39;ll call this hash a <code>Request</code>, so let&#39;s define it:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Request</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:body</span><span class="p">,</span> <span class="ss">:method</span><span class="p">,</span> <span class="ss">:headers</span><span class="p">,</span> <span class="ss">:url</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;GET&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Our program should expect the curl command as a command line
argument, so let&#39;s use <code>ARGV.first</code> to read the curl
command:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">require</span> <span class="s1">&#39;shellwords&#39;</span>

<span class="k">module</span> <span class="nn">ParseCurl</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="no">Request</span><span class="o">.</span><span class="n">new</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="no">Parser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

      <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Shellwords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">))</span>

      <span class="n">request</span><span class="o">.</span><span class="n">to_h</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="kp">attr_accessor</span> <span class="ss">:request</span>
    <span class="kp">attr_accessor</span> <span class="ss">:parser</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ParseCurl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</code></pre></div>
<p>We use <code>Shellwords</code> here to convert the curl command
to an array of tokens, to make it easier to parse.</p>

<p>Now that we have a place to store the result of parsing 
the curl command, and we are passing the command line
argument to a parser, it&#39;s time to write an actual parser.</p>

<p>Being a very serious and very senior developer,
I&#39;ve ended up with this very appealing class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Parser</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="vi">@request</span> <span class="o">=</span> <span class="n">request</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>
      <span class="n">parse_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="kp">attr_accessor</span> <span class="ss">:words</span>
  <span class="kp">attr_reader</span> <span class="ss">:request</span>

  <span class="k">def</span> <span class="nf">parse_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">word</span>
    <span class="k">when</span> <span class="no">URI</span><span class="o">::</span><span class="no">DEFAULT_PARSER</span><span class="o">.</span><span class="n">make_regexp</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">word</span>
    <span class="k">when</span> <span class="sr">/\A(-H|--header)\Z/</span>
      <span class="n">parse_header</span>
    <span class="k">when</span> <span class="sr">/\A--compressed\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Accept-Encoding&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;deflate, gzip&#39;</span>
    <span class="k">when</span> <span class="sr">/\A-X|\A--request\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">when</span> <span class="sr">/\A(-u|--user)\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Authorization&#39;</span><span class="o">]</span> <span class="o">||=</span>
        <span class="s2">&quot;Basic </span><span class="si">#{</span><span class="no">Base64</span><span class="o">.</span><span class="n">strict_encode64</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">when</span> <span class="sr">/\A(-b|--cookie)\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">when</span> <span class="sr">/\A(-A|--user-agent)\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">when</span> <span class="sr">/\A(-I|--head)\Z/</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;HEAD&#39;</span>
    <span class="k">when</span> <span class="sr">/\A(-d|--data|--data-ascii)\Z/</span>
      <span class="n">parse_data</span>
    <span class="k">when</span> <span class="sr">/\A--data-binary\Z/</span>
      <span class="n">parse_data</span><span class="p">(</span><span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
    <span class="k">when</span> <span class="sr">/\A--data-raw\Z/</span>
      <span class="n">parse_data</span><span class="p">(</span><span class="ss">raw</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
    <span class="k">when</span> <span class="sr">/\A--data-urlencode\Z/</span>
      <span class="n">parse_data</span><span class="p">(</span><span class="ss">url_encode</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
    <span class="k">when</span> <span class="sr">/\./</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">word</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>I know, a thing a beauty.</p>

<p>What&#39;s also very nice is that this class
also have to know everything about parsing curl arguments;
from header and method arguments to various data arguments.</p>

<p>Super nice! Just look at these beautiful methods, that
all belong to this class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Parser</span>
  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="o">||</span>
                               <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span>
    <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">]</span> <span class="o">||=</span>
      <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">extract_data</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">empty?</span>
                     <span class="n">data</span>
                   <span class="k">else</span>
                     <span class="s2">&quot;</span><span class="si">#{</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">#{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>
                   <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">parse_header</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">extract_header</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

    <span class="k">return</span> <span class="k">unless</span> <span class="n">header</span>

    <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">]</span> <span class="o">=</span>
      <span class="n">header</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">first</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/\A@/</span> <span class="o">||</span> <span class="n">args</span><span class="o">[</span><span class="ss">:raw</span><span class="o">]</span>
    <span class="n">data</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">word</span><span class="p">,</span>
                <span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
                <span class="ss">raw</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
                <span class="ss">url_encode</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">raw</span> <span class="p">?</span> <span class="n">word</span> <span class="p">:</span> <span class="n">word</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">content</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\n|\r/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">strip_newlines</span>
    <span class="n">content</span> <span class="o">=</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">url_encode</span>
    <span class="n">content</span>
  <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="k">raise</span> <span class="no">FileNotFoundError</span><span class="p">,</span>
      <span class="s2">&quot;Cannot read file: </span><span class="si">#{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">. Does it exist?&quot;</span>
  <span class="k">end</span>

  <span class="c1"># Needed for extracting -XPUT and similar formats.</span>
  <span class="k">def</span> <span class="nf">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span> <span class="k">unless</span> <span class="n">word</span> <span class="o">=~</span> <span class="sr">/^-X/</span>

    <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nb">method</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^-X(.*)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
      <span class="nb">method</span>
    <span class="k">else</span>
      <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">extract_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/: (.+)/</span><span class="p">)</span><span class="o">].</span><span class="n">to_h</span>
  <span class="k">rescue</span> <span class="no">StandardError</span>
    <span class="kp">nil</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Marvelous! This class knows absolutely everything
about curl and all the arguments and options.
We could ask it the curl&#39;s shoe size, 
and it would give us the answer.</p>

<p>Now that we have thought this class so much, and it
has achieved the master&#39;s degree worth of education
in the University of curl, I&#39;m a little worried it&#39;s going to take over the world.</p>

<p>Sure, it only knows about curl for now, but what happens
when someone decides it should know about, I don&#39;t know,
some scary AI thing. It looks innocent right now,
but then you turn around and it <a href="https://www.youtube.com/watch?v=aFuA50H9uek">gets interested in doors</a>. </p>

<p>I don&#39;t trust it one bit, so let&#39;s steal some knowledge
from this class and let&#39;s spread it to other classes.</p>

<p><em>I&#39;ll now start explaining the refactoring step by step,
but you can take a look at <a href="#final">the final result</a> if you&#39;d like to
skip.</em></p>

<p>This class will from now on be ignorant of curl arguments, so the humongous case statement becomes:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Parser</span>
  <span class="k">def</span> <span class="nf">parse_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="no">Word</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Since every scenario we have to cover in the case statement consists
of the regex check and the parsing part, the idea is to abstract those into 
class.</p>

<p>Let&#39;s introduce the <code>Word::Base</code> class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="c1"># Used to check if the word given matches the subclass&#39; regex.</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">word</span> <span class="o">=~</span> <span class="n">regex</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="k">raise</span> <span class="no">NotImplementedError</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> doesn&#39;t have .regex defined&quot;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="k">raise</span> <span class="no">NotImplementedError</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> doesn&#39;t have #parse defined&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The plan is to have one base class, that will be inherited for every
scenario we&#39;d like to cover. Here&#39;s the first example of one such class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">class</span> <span class="nc">Header</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-H|--header)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">header</span> <span class="o">=</span> <span class="n">extract_header</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

      <span class="k">return</span> <span class="k">unless</span> <span class="n">header</span>

      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">]</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">first</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">extract_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
      <span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/: (.+)/</span><span class="p">)</span><span class="o">].</span><span class="n">to_h</span>
    <span class="k">rescue</span> <span class="no">StandardError</span>
      <span class="kp">nil</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>This class stores information about everything that&#39;s needed to
parse a header argument. It detects the argument (when the curl command includes
<code>-H</code> or <code>--header</code> in arguments) and then changes the request hash,
which we return in the end.</p>

<p>Since this class has to know about <code>words</code> and <code>request</code>
too, we&#39;ll add that to the base class. We expect other descendants
to need that too:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
      <span class="vi">@words</span> <span class="o">=</span> <span class="n">words</span>
      <span class="vi">@request</span> <span class="o">=</span> <span class="n">request</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="kp">attr_reader</span> <span class="ss">:words</span>
    <span class="kp">attr_reader</span> <span class="ss">:request</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The next problem we have is that there&#39;s no connection between
the original <code>parse_word</code> method and this new class we have created,
so let&#39;s write a method that connects those two:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
    <span class="n">subclass</span> <span class="o">=</span> <span class="no">Word</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">subclasses</span>
                         <span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">klass</span><span class="o">|</span> <span class="n">klass</span> <span class="o">===</span> <span class="n">word</span> <span class="p">}</span>
    <span class="n">subclass</span><span class="o">&amp;.</span><span class="n">new</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">&amp;.</span><span class="n">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Base</span>
    <span class="c1"># List of subclasses, first-inherited class first.</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">subclasses</span>
      <span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="no">Base</span><span class="o">.</span><span class="n">singleton_class</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">klass</span><span class="o">|</span> <span class="n">klass</span> <span class="o">==</span> <span class="no">Base</span> <span class="p">}</span><span class="o">.</span><span class="n">reverse</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>With this method we can find a <code>Word::Base</code> subclass that matches the word
that was given and then parses that word. If we find the subclass,
we try to parse the word. So our current code works
for parsing <code>--header</code> or <code>-h</code> words from curl.</p>

<p>Our code now supports parsing headers, so let&#39;s proceed to add
classes for every argument we&#39;d like to support:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">class</span> <span class="nc">Compressed</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--compressed\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Accept-Encoding&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;deflate, gzip&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Request</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A-X|\A--request\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="c1"># Needed for extracting -XPUT and similar formats.</span>
    <span class="k">def</span> <span class="nf">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span> <span class="k">unless</span> <span class="n">word</span> <span class="o">=~</span> <span class="sr">/^-X/</span>

      <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nb">method</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^-X(.*)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
        <span class="nb">method</span>
      <span class="k">else</span>
        <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Authorization</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-u|--user)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Authorization&#39;</span><span class="o">]</span> <span class="o">||=</span>
        <span class="s2">&quot;Basic </span><span class="si">#{</span><span class="no">Base64</span><span class="o">.</span><span class="n">strict_encode64</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Cookie</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-b|--cookie)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">UserAgent</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-A|--user-agent)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Head</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-I|--head)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;HEAD&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Data</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-d|--data|--data-ascii)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="o">||</span>
                                 <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">]</span> <span class="o">||=</span>
        <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span>

      <span class="n">data</span> <span class="o">=</span> <span class="n">extract_data</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

      <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">empty?</span>
                       <span class="n">data</span>
                     <span class="k">else</span>
                       <span class="s2">&quot;</span><span class="si">#{</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">#{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>
                     <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/\A@/</span> <span class="o">||</span>
                                      <span class="n">args</span><span class="o">[</span><span class="ss">:raw</span><span class="o">]</span>
      <span class="n">data</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">word</span><span class="p">,</span>
                  <span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
                  <span class="ss">raw</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
                  <span class="ss">url_encode</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">raw</span> <span class="p">?</span> <span class="n">word</span> <span class="p">:</span> <span class="n">word</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
      <span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="n">content</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\n|\r/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">strip_newlines</span>
      <span class="n">content</span> <span class="o">=</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">url_encode</span>
      <span class="n">content</span>
    <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span>
      <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
      <span class="k">raise</span> <span class="no">FileNotFoundError</span><span class="p">,</span>
            <span class="s2">&quot;Cannot read file: </span><span class="si">#{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">. Does it exist?&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">StripNewlinesData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-binary\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">RawData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-raw\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">raw</span><span class="p">:</span> <span class="kp">true</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">URLEncodeData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-urlencode\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">url_encode</span><span class="p">:</span> <span class="kp">true</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">URL</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">word</span> <span class="o">=~</span> <span class="no">URI</span><span class="o">::</span><span class="no">DEFAULT_PARSER</span><span class="o">.</span><span class="n">make_regexp</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">word</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">NonStrictURL</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\./</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">word</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Here&#39;s the <a name="final">final</a> code we end up with:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">Word</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
    <span class="n">subclass</span> <span class="o">=</span> <span class="no">Word</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">subclasses</span>
                         <span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">klass</span><span class="o">|</span> <span class="n">klass</span> <span class="o">===</span> <span class="n">word</span> <span class="p">}</span>
    <span class="n">subclass</span><span class="o">&amp;.</span><span class="n">new</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">&amp;.</span><span class="n">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Base</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
      <span class="vi">@words</span> <span class="o">=</span> <span class="n">words</span>
      <span class="vi">@request</span> <span class="o">=</span> <span class="n">request</span>
    <span class="k">end</span>

    <span class="c1"># List of subclasses, first-inherited class appears first.</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">subclasses</span>
      <span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="no">Base</span><span class="o">.</span><span class="n">singleton_class</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">klass</span><span class="o">|</span> <span class="n">klass</span> <span class="o">==</span> <span class="no">Base</span> <span class="p">}</span><span class="o">.</span><span class="n">reverse</span>
    <span class="k">end</span>

    <span class="c1"># Used to check if the word given matches the subclass&#39; regex.</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">word</span> <span class="o">=~</span> <span class="n">regex</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="k">raise</span> <span class="no">NotImplementedError</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> doesn&#39;t have .regex defined&quot;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="k">raise</span> <span class="no">NotImplementedError</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> doesn&#39;t have #parse defined&quot;</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="kp">attr_reader</span> <span class="ss">:words</span>
    <span class="kp">attr_reader</span> <span class="ss">:request</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Header</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-H|--header)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">header</span> <span class="o">=</span> <span class="n">extract_header</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

      <span class="k">return</span> <span class="k">unless</span> <span class="n">header</span>

      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">]</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">first</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">extract_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
      <span class="o">[</span><span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/: (.+)/</span><span class="p">)</span><span class="o">].</span><span class="n">to_h</span>
    <span class="k">rescue</span> <span class="no">StandardError</span>
      <span class="kp">nil</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Compressed</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--compressed\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Accept-Encoding&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;deflate, gzip&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Request</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A-X|\A--request\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="c1"># Needed for extracting -XPUT and similar formats.</span>
    <span class="k">def</span> <span class="nf">extract_method</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span> <span class="k">unless</span> <span class="n">word</span> <span class="o">=~</span> <span class="sr">/^-X/</span>

      <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nb">method</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^-X(.*)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
        <span class="nb">method</span>
      <span class="k">else</span>
        <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Authorization</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-u|--user)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Authorization&#39;</span><span class="o">]</span> <span class="o">||=</span>
        <span class="s2">&quot;Basic </span><span class="si">#{</span><span class="no">Base64</span><span class="o">.</span><span class="n">strict_encode64</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Cookie</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-b|--cookie)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">UserAgent</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-A|--user-agent)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;User-Agent&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Head</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-I|--head)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;HEAD&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Data</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A(-d|--data|--data-ascii)\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="o">||</span>
                                 <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;HEAD&#39;</span>
      <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">]</span> <span class="o">||=</span>
        <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span>

      <span class="n">data</span> <span class="o">=</span> <span class="n">extract_data</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

      <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">empty?</span>
                       <span class="n">data</span>
                     <span class="k">else</span>
                       <span class="s2">&quot;</span><span class="si">#{</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">#{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>
                     <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="o">=~</span> <span class="sr">/\A@/</span> <span class="o">||</span>
                                      <span class="n">args</span><span class="o">[</span><span class="ss">:raw</span><span class="o">]</span>
      <span class="n">data</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">word</span><span class="p">,</span>
                  <span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
                  <span class="ss">raw</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
                  <span class="ss">url_encode</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">raw</span> <span class="p">?</span> <span class="n">word</span> <span class="p">:</span> <span class="n">word</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
      <span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="n">content</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\n|\r/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">strip_newlines</span>
      <span class="n">content</span> <span class="o">=</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">url_encode</span>
      <span class="n">content</span>
    <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span>
      <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">data</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
      <span class="k">raise</span> <span class="no">FileNotFoundError</span><span class="p">,</span>
            <span class="s2">&quot;Cannot read file: </span><span class="si">#{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">. Does it exist?&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">StripNewlinesData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-binary\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">strip_newlines</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">RawData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-raw\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">raw</span><span class="p">:</span> <span class="kp">true</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">URLEncodeData</span> <span class="o">&lt;</span> <span class="no">Data</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\A--data-urlencode\Z/</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">options</span>
      <span class="p">{</span> <span class="ss">url_encode</span><span class="p">:</span> <span class="kp">true</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">URL</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">===</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">word</span> <span class="o">=~</span> <span class="no">URI</span><span class="o">::</span><span class="no">DEFAULT_PARSER</span><span class="o">.</span><span class="n">make_regexp</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">word</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">NonStrictURL</span> <span class="o">&lt;</span> <span class="no">Base</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">regex</span>
      <span class="sr">/\./</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
      <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">word</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Parser</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="vi">@request</span> <span class="o">=</span> <span class="n">request</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>
      <span class="n">parse_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="kp">attr_accessor</span> <span class="ss">:words</span>
  <span class="kp">attr_reader</span> <span class="ss">:request</span>

  <span class="k">def</span> <span class="nf">parse_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="no">Word</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">ParseCurl</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="no">Request</span><span class="o">.</span><span class="n">new</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="no">Parser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

      <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Shellwords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">))</span>

      <span class="n">request</span><span class="o">.</span><span class="n">to_h</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="kp">attr_accessor</span> <span class="ss">:request</span>
    <span class="kp">attr_accessor</span> <span class="ss">:parser</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ParseCurl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</code></pre></div>
<p>Note how each class contains knowledge specific to the 
argument we&#39;re trying to cover with it and nothing else. I
think that&#39;s an improvement since it&#39;s still easy to 
support new arguments, and we don&#39;t pollute a single class
with many methods.</p>


            <div class="flex items-center" data-nosnippet>
              <div class="kudo">
              </div>

              <div class="ml-2 font-bold text-black">
                <span data-js-kudos-count>
                  0
                </span>

                kudos
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
  (function webpackUniversalModuleDefinition(root, factory) {
    if(typeof exports === 'object' && typeof module === 'object')
      module.exports = factory();
    else if(typeof define === 'function' && define.amd)
      define(factory);
    else if(typeof exports === 'object')
      exports["kudos"] = factory();
    else
      root["kudos"] = factory();
  })(this, function() {
    return /******/ (function(modules) { // webpackBootstrap
      /******/ 	// The module cache
      /******/ 	var installedModules = {};

      /******/ 	// The require function
      /******/ 	function __webpack_require__(moduleId) {

        /******/ 		// Check if module is in cache
        /******/ 		if(installedModules[moduleId])
          /******/ 			return installedModules[moduleId].exports;

        /******/ 		// Create a new module (and put it into the cache)
        /******/ 		var module = installedModules[moduleId] = {
          /******/ 			exports: {},
          /******/ 			id: moduleId,
          /******/ 			loaded: false
        /******/ 		};

        /******/ 		// Execute the module function
        /******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

        /******/ 		// Flag the module as loaded
        /******/ 		module.loaded = true;

        /******/ 		// Return the exports of the module
        /******/ 		return module.exports;
      /******/ 	}


      /******/ 	// expose the modules object (__webpack_modules__)
      /******/ 	__webpack_require__.m = modules;

      /******/ 	// expose the module cache
      /******/ 	__webpack_require__.c = installedModules;

      /******/ 	// __webpack_public_path__
      /******/ 	__webpack_require__.p = "";

      /******/ 	// Load entry module and return exports
      /******/ 	return __webpack_require__(0);
    /******/ })
    /************************************************************************/
    /******/ ([
      /* 0 */
      /***/ function(module, exports, __webpack_require__) {

        __webpack_require__(1)
        var html = __webpack_require__(5)
        var bean = __webpack_require__(8)

        var datas = [];
        var donothing = function(evt) {
          evt.stop();
        };
        var start = function(evt) {
          evt.stop();
          var target = evt.currentTarget;
          var attr = Array.apply(null,target.attributes);
          var id = attr.filter(function(v) {
            return v.name=='data-id';
          }).shift().value;
          var d = datas[id];
          if(d.state) return;
          target.className = 'kudos-js-container hover';
          var done = function() {
            if(!d.state) {
              target.className = 'kudos-js-container yes';
              d.state = true;
              if(d.onkudo) {
                d.onkudo(function() {
                  // done
                });
              }
            }
          };
          d.tid = setTimeout(function() {
            done();
          },1200);
        };
        var cancel = function(evt) {
          evt.stop();
          var target = evt.currentTarget;
          var attr = Array.apply(null,target.attributes);
          var id = attr.filter(function(v) {
            return v.name=='data-id';
          }).shift().value;
          var d = datas[id];
          clearTimeout(d.tid);
          if(d.state) return;
          target.className = 'kudos-js-container';
        };
        var kudos = function(sel,data) {
          if(!data) data = {};
          data.id = datas.length;
          sel.innerHTML = html(data);
          datas.push(data);
          if('ontouchstart' in document.documentElement) {
            bean.on(sel.firstChild,'touchstart',start);
            bean.on(sel.firstChild,'touchend',cancel);
          } else {
            bean.on(sel.firstChild,'mouseover',start);
            bean.on(sel.firstChild,'mouseout',cancel);
          }
          bean.on(sel,'click touchstart touchend mouseover mouseout',donothing);
        };

        module.exports = kudos;


      /***/ },
      /* 1 */
      /***/ function(module, exports, __webpack_require__) {

        // style-loader: Adds some css to the DOM by adding a <style> tag

// load the styles
var content = __webpack_require__(2);
if(typeof content === 'string') content = [[module.id, content, '']];
// add the styles to the DOM
var update = __webpack_require__(4)(content, {});
if(content.locals) module.exports = content.locals;
// Hot Module Replacement
if(false) {
  // When the styles change, update the <style> tags
if(!content.locals) {
  module.hot.accept("!!./../node_modules/css-loader/index.js!./style.css", function() {
    var newContent = require("!!./../node_modules/css-loader/index.js!./style.css");
    if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];
    update(newContent);
  });
}
// When the module is disposed, remove the <style> tags
module.hot.dispose(function() { update(); });
}

        /***/ },
        /* 2 */
        /***/ function(module, exports, __webpack_require__) {

        exports = module.exports = __webpack_require__(3)();
        // imports


        // module
        exports.push([module.id, ".kudos-js-container{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%22-311%20373%2048%2048%22%3E%3Cstyle%3E.st0%7Bfill%3Anone%3B%7D%3C%2Fstyle%3E%3Cpath%20d%3D%22M-287%20373c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024%2024-10.7%2024-24-10.7-24-24-24zm0%2045c-11.6%200-21-9.4-21-21s9.4-21%2021-21%2021%209.4%2021%2021-9.4%2021-21%2021z%22%20id%3D%22Layer_1%22%2F%3E%3Cpath%20class%3D%22st0%22%20d%3D%22M-311%20373h48v48h-48z%22%20id%3D%22Layer_4%22%2F%3E%3C%2Fsvg%3E) center center no-repeat;user-select:none;touch-callout:none}.kudos-js-container,.kudos-js-container a{width:48px;height:48px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}@-webkit-keyframes animation{0%{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}1.35%{-webkit-transform:matrix3d(1.233,0,0,0,0,1.233,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.233,0,0,0,0,1.233,0,0,0,0,1,0,0,0,0,1)}2.7%{-webkit-transform:matrix3d(1.549,0,0,0,0,1.549,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.549,0,0,0,0,1.549,0,0,0,0,1,0,0,0,0,1)}4.05%{-webkit-transform:matrix3d(1.781,0,0,0,0,1.781,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.781,0,0,0,0,1.781,0,0,0,0,1,0,0,0,0,1)}5.36%{-webkit-transform:matrix3d(1.855,0,0,0,0,1.855,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.855,0,0,0,0,1.855,0,0,0,0,1,0,0,0,0,1)}6.86%{-webkit-transform:matrix3d(1.784,0,0,0,0,1.784,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.784,0,0,0,0,1.784,0,0,0,0,1,0,0,0,0,1)}8.31%{-webkit-transform:matrix3d(1.646,0,0,0,0,1.646,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.646,0,0,0,0,1.646,0,0,0,0,1,0,0,0,0,1)}9.81%{-webkit-transform:matrix3d(1.532,0,0,0,0,1.532,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.532,0,0,0,0,1.532,0,0,0,0,1,0,0,0,0,1)}11.26%{-webkit-transform:matrix3d(1.496,0,0,0,0,1.496,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.496,0,0,0,0,1.496,0,0,0,0,1,0,0,0,0,1)}14.21%{-webkit-transform:matrix3d(1.582,0,0,0,0,1.582,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.582,0,0,0,0,1.582,0,0,0,0,1,0,0,0,0,1)}17.17%{-webkit-transform:matrix3d(1.643,0,0,0,0,1.643,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.643,0,0,0,0,1.643,0,0,0,0,1,0,0,0,0,1)}23.02%{-webkit-transform:matrix3d(1.583,0,0,0,0,1.583,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.583,0,0,0,0,1.583,0,0,0,0,1,0,0,0,0,1)}28.93%{-webkit-transform:matrix3d(1.607,0,0,0,0,1.607,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.607,0,0,0,0,1.607,0,0,0,0,1,0,0,0,0,1)}34.78%{-webkit-transform:matrix3d(1.597,0,0,0,0,1.597,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.597,0,0,0,0,1.597,0,0,0,0,1,0,0,0,0,1)}40.69%{-webkit-transform:matrix3d(1.601,0,0,0,0,1.601,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.601,0,0,0,0,1.601,0,0,0,0,1,0,0,0,0,1)}46.6%,49.9%,50%{-webkit-transform:matrix3d(1.6,0,0,0,0,1.6,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.6,0,0,0,0,1.6,0,0,0,0,1,0,0,0,0,1)}53.15%{-webkit-transform:matrix3d(1.37,0,0,0,0,1.37,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.37,0,0,0,0,1.37,0,0,0,0,1,0,0,0,0,1)}56.26%{-webkit-transform:matrix3d(1.227,0,0,0,0,1.227,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.227,0,0,0,0,1.227,0,0,0,0,1,0,0,0,0,1)}59.41%{-webkit-transform:matrix3d(1.137,0,0,0,0,1.137,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.137,0,0,0,0,1.137,0,0,0,0,1,0,0,0,0,1)}62.51%{-webkit-transform:matrix3d(1.083,0,0,0,0,1.083,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.083,0,0,0,0,1.083,0,0,0,0,1,0,0,0,0,1)}68.77%{-webkit-transform:matrix3d(1.029,0,0,0,0,1.029,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.029,0,0,0,0,1.029,0,0,0,0,1,0,0,0,0,1)}75.03%{-webkit-transform:matrix3d(1.009,0,0,0,0,1.009,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.009,0,0,0,0,1.009,0,0,0,0,1,0,0,0,0,1)}87.54%{-webkit-transform:matrix3d(1.001,0,0,0,0,1.001,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.001,0,0,0,0,1.001,0,0,0,0,1,0,0,0,0,1)}100%{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}}@keyframes animation{0%{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}1.35%{-webkit-transform:matrix3d(1.233,0,0,0,0,1.233,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.233,0,0,0,0,1.233,0,0,0,0,1,0,0,0,0,1)}2.7%{-webkit-transform:matrix3d(1.549,0,0,0,0,1.549,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.549,0,0,0,0,1.549,0,0,0,0,1,0,0,0,0,1)}4.05%{-webkit-transform:matrix3d(1.781,0,0,0,0,1.781,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.781,0,0,0,0,1.781,0,0,0,0,1,0,0,0,0,1)}5.36%{-webkit-transform:matrix3d(1.855,0,0,0,0,1.855,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.855,0,0,0,0,1.855,0,0,0,0,1,0,0,0,0,1)}6.86%{-webkit-transform:matrix3d(1.784,0,0,0,0,1.784,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.784,0,0,0,0,1.784,0,0,0,0,1,0,0,0,0,1)}8.31%{-webkit-transform:matrix3d(1.646,0,0,0,0,1.646,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.646,0,0,0,0,1.646,0,0,0,0,1,0,0,0,0,1)}9.81%{-webkit-transform:matrix3d(1.532,0,0,0,0,1.532,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.532,0,0,0,0,1.532,0,0,0,0,1,0,0,0,0,1)}11.26%{-webkit-transform:matrix3d(1.496,0,0,0,0,1.496,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.496,0,0,0,0,1.496,0,0,0,0,1,0,0,0,0,1)}14.21%{-webkit-transform:matrix3d(1.582,0,0,0,0,1.582,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.582,0,0,0,0,1.582,0,0,0,0,1,0,0,0,0,1)}17.17%{-webkit-transform:matrix3d(1.643,0,0,0,0,1.643,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.643,0,0,0,0,1.643,0,0,0,0,1,0,0,0,0,1)}23.02%{-webkit-transform:matrix3d(1.583,0,0,0,0,1.583,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.583,0,0,0,0,1.583,0,0,0,0,1,0,0,0,0,1)}28.93%{-webkit-transform:matrix3d(1.607,0,0,0,0,1.607,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.607,0,0,0,0,1.607,0,0,0,0,1,0,0,0,0,1)}34.78%{-webkit-transform:matrix3d(1.597,0,0,0,0,1.597,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.597,0,0,0,0,1.597,0,0,0,0,1,0,0,0,0,1)}40.69%{-webkit-transform:matrix3d(1.601,0,0,0,0,1.601,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.601,0,0,0,0,1.601,0,0,0,0,1,0,0,0,0,1)}46.6%,49.9%,50%{-webkit-transform:matrix3d(1.6,0,0,0,0,1.6,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.6,0,0,0,0,1.6,0,0,0,0,1,0,0,0,0,1)}53.15%{-webkit-transform:matrix3d(1.37,0,0,0,0,1.37,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.37,0,0,0,0,1.37,0,0,0,0,1,0,0,0,0,1)}56.26%{-webkit-transform:matrix3d(1.227,0,0,0,0,1.227,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.227,0,0,0,0,1.227,0,0,0,0,1,0,0,0,0,1)}59.41%{-webkit-transform:matrix3d(1.137,0,0,0,0,1.137,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.137,0,0,0,0,1.137,0,0,0,0,1,0,0,0,0,1)}62.51%{-webkit-transform:matrix3d(1.083,0,0,0,0,1.083,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.083,0,0,0,0,1.083,0,0,0,0,1,0,0,0,0,1)}68.77%{-webkit-transform:matrix3d(1.029,0,0,0,0,1.029,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.029,0,0,0,0,1.029,0,0,0,0,1,0,0,0,0,1)}75.03%{-webkit-transform:matrix3d(1.009,0,0,0,0,1.009,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.009,0,0,0,0,1.009,0,0,0,0,1,0,0,0,0,1)}87.54%{-webkit-transform:matrix3d(1.001,0,0,0,0,1.001,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1.001,0,0,0,0,1.001,0,0,0,0,1,0,0,0,0,1)}100%{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}}.kudos-js-container a{display:block;background:url(data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%22-281%20373%2048%2048%22%3E%3Cstyle%3E.st0%7Bfill%3Anone%3B%7D%3C%2Fstyle%3E%3Ccircle%20id%3D%22Layer_3%22%20cx%3D%22-257%22%20cy%3D%22397%22%20r%3D%2224%22%2F%3E%3Cpath%20id%3D%22Layer_4%22%20class%3D%22st0%22%20d%3D%22M-281%20373h48v48h-48v-48z%22%2F%3E%3C%2Fsvg%3E) center center no-repeat;-webkit-transition:background-size 1.2s linear;transition:background-size 1.2s linear;background-size:25% 25%;user-select:none;touch-callout:none}.kudos-js-container a:hover,.kudos-js-container.hover a,.kudos-js-container.yes a,.kudos-js-container.yes a:hover{background-size:100% 100%}.kudos-js-container.yes a{-webkit-animation:animation 2000ms linear both;animation:animation 2000ms linear both;cursor:default;background-image:url(data:image/svg+xml,%3Csvg%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%22-281%20373%2048%2048%22%3E%3Cstyle%3E.st0%7Bfill%3Anone%3B%7D%3C%2Fstyle%3E%3Cpath%20d%3D%22M-257%20379c-9.9%200-18%208.1-18%2018s8.1%2018%2018%2018%2018-8.1%2018-18-8.1-18-18-18zm1.1%2024l-1.1%201-1.1-1c-3.9-3.5-6.4-5.8-6.4-8.6%200-2.3%201.8-4.1%204.1-4.1%201.3%200%202.6.6%203.4%201.6.8-1%202.1-1.6%203.4-1.6%202.3%200%204.1%201.8%204.1%204.1%200%202.8-2.5%205.1-6.4%208.6z%22%2F%3E%3Cpath%20class%3D%22st0%22%20d%3D%22M-281%20373h48v48h-48z%22%2F%3E%3C%2Fsvg%3E);-webkit-transition:none;transition:none}", ""]);

        // exports


      /***/ },
      /* 3 */
      /***/ function(module, exports) {

      /*
         MIT License http://www.opensource.org/licenses/mit-license.php
         Author Tobias Koppers @sokra
       */
        // css base code, injected by the css-loader
        module.exports = function() {
          var list = [];

          // return the list of modules as css string
          list.toString = function toString() {
            var result = [];
            for(var i = 0; i < this.length; i++) {
              var item = this[i];
              if(item[2]) {
                result.push("@media " + item[2] + "{" + item[1] + "}");
              } else {
                result.push(item[1]);
              }
            }
            return result.join("");
          };

          // import a list of modules into the list
          list.i = function(modules, mediaQuery) {
            if(typeof modules === "string")
            modules = [[null, modules, ""]];
            var alreadyImportedModules = {};
            for(var i = 0; i < this.length; i++) {
              var id = this[i][0];
              if(typeof id === "number")
              alreadyImportedModules[id] = true;
            }
            for(i = 0; i < modules.length; i++) {
              var item = modules[i];
              // skip already imported module
              // this implementation is not 100% perfect for weird media query combinations
              //  when a module is imported multiple times with different media queries.
              //  I hope this will never occur (Hey this way we have smaller bundles)
              if(typeof item[0] !== "number" || !alreadyImportedModules[item[0]]) {
                if(mediaQuery && !item[2]) {
                  item[2] = mediaQuery;
                } else if(mediaQuery) {
                  item[2] = "(" + item[2] + ") and (" + mediaQuery + ")";
                }
                list.push(item);
              }
            }
          };
          return list;
        };


      /***/ },
      /* 4 */
      /***/ function(module, exports, __webpack_require__) {

      /*
         MIT License http://www.opensource.org/licenses/mit-license.php
         Author Tobias Koppers @sokra
       */
        var stylesInDom = {},
        memoize = function(fn) {
          var memo;
          return function () {
            if (typeof memo === "undefined") memo = fn.apply(this, arguments);
            return memo;
          };
        },
        isOldIE = memoize(function() {
          return /msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase());
        }),
      getHeadElement = memoize(function () {
        return document.head || document.getElementsByTagName("head")[0];
      }),
    singletonElement = null,
    singletonCounter = 0;

    module.exports = function(list, options) {
      if(false) {
        if(typeof document !== "object") throw new Error("The style-loader cannot be used in a non-browser environment");
      }

      options = options || {};
      // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
// tags it will allow on a page
if (typeof options.singleton === "undefined") options.singleton = isOldIE();

var styles = listToStyles(list);
addStylesToDom(styles, options);

return function update(newList) {
  var mayRemove = [];
  for(var i = 0; i < styles.length; i++) {
    var item = styles[i];
    var domStyle = stylesInDom[item.id];
    domStyle.refs--;
    mayRemove.push(domStyle);
  }
  if(newList) {
    var newStyles = listToStyles(newList);
    addStylesToDom(newStyles, options);
  }
  for(var i = 0; i < mayRemove.length; i++) {
    var domStyle = mayRemove[i];
    if(domStyle.refs === 0) {
      for(var j = 0; j < domStyle.parts.length; j++)
      domStyle.parts[j]();
      delete stylesInDom[domStyle.id];
    }
  }
};
    }

    function addStylesToDom(styles, options) {
      for(var i = 0; i < styles.length; i++) {
        var item = styles[i];
        var domStyle = stylesInDom[item.id];
        if(domStyle) {
          domStyle.refs++;
          for(var j = 0; j < domStyle.parts.length; j++) {
            domStyle.parts[j](item.parts[j]);
          }
          for(; j < item.parts.length; j++) {
            domStyle.parts.push(addStyle(item.parts[j], options));
          }
        } else {
          var parts = [];
          for(var j = 0; j < item.parts.length; j++) {
            parts.push(addStyle(item.parts[j], options));
          }
          stylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};
        }
      }
    }

    function listToStyles(list) {
      var styles = [];
      var newStyles = {};
      for(var i = 0; i < list.length; i++) {
        var item = list[i];
        var id = item[0];
        var css = item[1];
        var media = item[2];
        var sourceMap = item[3];
        var part = {css: css, media: media, sourceMap: sourceMap};
        if(!newStyles[id])
        styles.push(newStyles[id] = {id: id, parts: [part]});
        else
        newStyles[id].parts.push(part);
      }
      return styles;
    }

    function createStyleElement() {
      var styleElement = document.createElement("style");
      var head = getHeadElement();
      styleElement.type = "text/css";
      head.appendChild(styleElement);
      return styleElement;
    }

    function createLinkElement() {
      var linkElement = document.createElement("link");
      var head = getHeadElement();
      linkElement.rel = "stylesheet";
      head.appendChild(linkElement);
      return linkElement;
    }

    function addStyle(obj, options) {
      var styleElement, update, remove;

      if (options.singleton) {
        var styleIndex = singletonCounter++;
        styleElement = singletonElement || (singletonElement = createStyleElement());
        update = applyToSingletonTag.bind(null, styleElement, styleIndex, false);
        remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true);
      } else if(obj.sourceMap &&
        typeof URL === "function" &&
      typeof URL.createObjectURL === "function" &&
      typeof URL.revokeObjectURL === "function" &&
      typeof Blob === "function" &&
      typeof btoa === "function") {
        styleElement = createLinkElement();
        update = updateLink.bind(null, styleElement);
        remove = function() {
          styleElement.parentNode.removeChild(styleElement);
          if(styleElement.href)
          URL.revokeObjectURL(styleElement.href);
        };
      } else {
        styleElement = createStyleElement();
        update = applyToTag.bind(null, styleElement);
        remove = function() {
          styleElement.parentNode.removeChild(styleElement);
        };
      }

      update(obj);

      return function updateStyle(newObj) {
        if(newObj) {
          if(newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap)
          return;
          update(obj = newObj);
        } else {
          remove();
        }
      };
    }

    var replaceText = (function () {
      var textStore = [];

      return function (index, replacement) {
        textStore[index] = replacement;
        return textStore.filter(Boolean).join('\n');
      };
    })();

  function applyToSingletonTag(styleElement, index, remove, obj) {
    var css = remove ? "" : obj.css;

    if (styleElement.styleSheet) {
      styleElement.styleSheet.cssText = replaceText(index, css);
    } else {
      var cssNode = document.createTextNode(css);
      var childNodes = styleElement.childNodes;
      if (childNodes[index]) styleElement.removeChild(childNodes[index]);
      if (childNodes.length) {
        styleElement.insertBefore(cssNode, childNodes[index]);
      } else {
        styleElement.appendChild(cssNode);
      }
    }
  }

  function applyToTag(styleElement, obj) {
    var css = obj.css;
    var media = obj.media;
    var sourceMap = obj.sourceMap;

    if(media) {
      styleElement.setAttribute("media", media)
    }

    if(styleElement.styleSheet) {
      styleElement.styleSheet.cssText = css;
    } else {
      while(styleElement.firstChild) {
        styleElement.removeChild(styleElement.firstChild);
      }
      styleElement.appendChild(document.createTextNode(css));
    }
  }

  function updateLink(linkElement, obj) {
    var css = obj.css;
    var media = obj.media;
    var sourceMap = obj.sourceMap;

    if(sourceMap) {
      // http://stackoverflow.com/a/26603875
      css += "\n/*# sourceMappingURL=data:application/json;base64," + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + " */";
    }

    var blob = new Blob([css], { type: "text/css" });

    var oldSrc = linkElement.href;

    linkElement.href = URL.createObjectURL(blob);

    if(oldSrc)
    URL.revokeObjectURL(oldSrc);
  }


  /***/ },
  /* 5 */
  /***/ function(module, exports, __webpack_require__) {

  var jade = __webpack_require__(6);

  module.exports = function template(locals) {
    var buf = [];
    var jade_mixins = {};
    var jade_interp;
    ;var locals_for_with = (locals || {});(function (id, state) {
      buf.push("<div" + (jade.attr("data-id", "" + (id) + "", true, false)) + (jade.cls(['kudos-js-container',"" + (state?'yes':'') + ""], [null,true])) + "><a href=\"#\"></a></div>");}.call(this,"id" in locals_for_with?locals_for_with.id:typeof id!=="undefined"?id:undefined,"state" in locals_for_with?locals_for_with.state:typeof state!=="undefined"?state:undefined));;return buf.join("");
  }

  /***/ },
  /* 6 */
  /***/ function(module, exports, __webpack_require__) {

  'use strict';

/**
 * Merge two attribute objects giving precedence
 * to values in object `b`. Classes are special-cased
 * allowing for arrays and merging/joining appropriately
 * resulting in a string.
 *
 * @param {Object} a
 * @param {Object} b
 * @return {Object} a
 * @api private
 */

  exports.merge = function merge(a, b) {
    if (arguments.length === 1) {
      var attrs = a[0];
      for (var i = 1; i < a.length; i++) {
        attrs = merge(attrs, a[i]);
      }
      return attrs;
    }
    var ac = a['class'];
    var bc = b['class'];

    if (ac || bc) {
      ac = ac || [];
      bc = bc || [];
      if (!Array.isArray(ac)) ac = [ac];
      if (!Array.isArray(bc)) bc = [bc];
      a['class'] = ac.concat(bc).filter(nulls);
    }

    for (var key in b) {
      if (key != 'class') {
        a[key] = b[key];
      }
    }

    return a;
  };

/**
 * Filter null `val`s.
 *
 * @param {*} val
 * @return {Boolean}
 * @api private
 */

  function nulls(val) {
    return val != null && val !== '';
  }

  /**
   * join array as classes.
   *
   * @param {*} val
   * @return {String}
   */
  exports.joinClasses = joinClasses;
  function joinClasses(val) {
    return (Array.isArray(val) ? val.map(joinClasses) :
      (val && typeof val === 'object') ? Object.keys(val).filter(function (key) { return val[key]; }) :
    [val]).filter(nulls).join(' ');
  }

  /**
   * Render the given classes.
   *
   * @param {Array} classes
   * @param {Array.<Boolean>} escaped
   * @return {String}
   */
  exports.cls = function cls(classes, escaped) {
    var buf = [];
    for (var i = 0; i < classes.length; i++) {
      if (escaped && escaped[i]) {
        buf.push(exports.escape(joinClasses([classes[i]])));
      } else {
        buf.push(joinClasses(classes[i]));
      }
    }
    var text = joinClasses(buf);
    if (text.length) {
      return ' class="' + text + '"';
    } else {
      return '';
    }
  };


  exports.style = function (val) {
    if (val && typeof val === 'object') {
      return Object.keys(val).map(function (style) {
        return style + ':' + val[style];
      }).join(';');
    } else {
      return val;
    }
  };
/**
 * Render the given attribute.
 *
 * @param {String} key
 * @param {String} val
 * @param {Boolean} escaped
 * @param {Boolean} terse
 * @return {String}
 */
  exports.attr = function attr(key, val, escaped, terse) {
    if (key === 'style') {
      val = exports.style(val);
    }
    if ('boolean' == typeof val || null == val) {
      if (val) {
        return ' ' + (terse ? key : key + '="' + key + '"');
      } else {
        return '';
      }
    } else if (0 == key.indexOf('data') && 'string' != typeof val) {
      if (JSON.stringify(val).indexOf('&') !== -1) {
        console.warn('Since Jade 2.0.0, ampersands (`&`) in data attributes ' +
          'will be escaped to `&amp;`');
      };
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will eliminate the double quotes around dates in ' +
          'ISO form after 2.0.0');
      }
      return ' ' + key + "='" + JSON.stringify(val).replace(/'/g, '&apos;') + "'";
    } else if (escaped) {
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will stringify dates in ISO form after 2.0.0');
      }
      return ' ' + key + '="' + exports.escape(val) + '"';
    } else {
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will stringify dates in ISO form after 2.0.0');
      }
      return ' ' + key + '="' + val + '"';
    }
  };

/**
 * Render the given attributes object.
 *
 * @param {Object} obj
 * @param {Object} escaped
 * @return {String}
 */
  exports.attrs = function attrs(obj, terse){
    var buf = [];

    var keys = Object.keys(obj);

    if (keys.length) {
      for (var i = 0; i < keys.length; ++i) {
        var key = keys[i]
        , val = obj[key];

        if ('class' == key) {
          if (val = joinClasses(val)) {
            buf.push(' ' + key + '="' + val + '"');
          }
        } else {
          buf.push(exports.attr(key, val, false, terse));
        }
      }
    }

    return buf.join('');
  };

/**
 * Escape the given string of `html`.
 *
 * @param {String} html
 * @return {String}
 * @api private
 */

  var jade_encode_html_rules = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;'
  };
  var jade_match_html = /[&<>"]/g;

  function jade_encode_char(c) {
    return jade_encode_html_rules[c] || c;
  }

  exports.escape = jade_escape;
  function jade_escape(html){
    var result = String(html).replace(jade_match_html, jade_encode_char);
    if (result === '' + html) return html;
    else return result;
  };

/**
 * Re-throw the given `err` in context to the
 * the jade in `filename` at the given `lineno`.
 *
 * @param {Error} err
 * @param {String} filename
 * @param {String} lineno
 * @api private
 */

  exports.rethrow = function rethrow(err, filename, lineno, str){
    if (!(err instanceof Error)) throw err;
    if ((typeof window != 'undefined' || !filename) && !str) {
      err.message += ' on line ' + lineno;
      throw err;
    }
    try {
      str = str || __webpack_require__(7).readFileSync(filename, 'utf8')
    } catch (ex) {
      rethrow(err, null, lineno)
    }
    var context = 3
    , lines = str.split('\n')
    , start = Math.max(lineno - context, 0)
    , end = Math.min(lines.length, lineno + context);

    // Error context
    var context = lines.slice(start, end).map(function(line, i){
      var curr = i + start + 1;
      return (curr == lineno ? '  > ' : '    ')
      + curr
      + '| '
      + line;
    }).join('\n');

  // Alter exception message
  err.path = filename;
  err.message = (filename || 'Jade') + ':' + lineno
  + '\n' + context + '\n\n' + err.message;
  throw err;
  };

  exports.DebugItem = function DebugItem(lineno, filename) {
    this.lineno = lineno;
    this.filename = filename;
  }


  /***/ },
  /* 7 */
  /***/ function(module, exports) {

  /* (ignored) */

  /***/ },
  /* 8 */
  /***/ function(module, exports, __webpack_require__) {

  var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!
                                                                     * Bean - copyright (c) Jacob Thornton 2011-2012
                                                                     * https://github.com/fat/bean
                                                                     * MIT license
                                                                     */
  (function (name, context, definition) {
    if (typeof module != 'undefined' && module.exports) module.exports = definition()
    else if (true) !(__WEBPACK_AMD_DEFINE_FACTORY__ = (definition), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))
    else context[name] = definition()
  })('bean', this, function (name, context) {
    name    = name    || 'bean'
    context = context || this

    var win            = window
    , old            = context[name]
    , namespaceRegex = /[^\.]*(?=\..*)\.|.*/
  , nameRegex      = /\..*/
  , addEvent       = 'addEventListener'
  , removeEvent    = 'removeEventListener'
  , doc            = document || {}
  , root           = doc.documentElement || {}
  , W3C_MODEL      = root[addEvent]
  , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'
  , ONE            = {} // singleton for quick matching making add() do one()

  , slice          = Array.prototype.slice
  , str2arr        = function (s, d) { return s.split(d || ' ') }
  , isString       = function (o) { return typeof o == 'string' }
  , isFunction     = function (o) { return typeof o == 'function' }

  // events that we consider to be 'native', anything not in this list will
  // be treated as a custom event
  , standardNativeEvents =
  'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons
  'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel
  'mouseover mouseout mousemove selectstart selectend '            + // mouse movement
  'keydown keypress keyup '                                        + // keyboard
  'orientationchange '                                             + // mobile
  'focus blur change reset select submit '                         + // form elements
  'load unload beforeunload resize move DOMContentLoaded '         + // window
  'readystatechange message '                                      + // window
  'error abort scroll '                                              // misc
  // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event
    // that doesn't actually exist, so make sure we only do these on newer browsers
    , w3cNativeEvents =
    'show '                                                          + // mouse buttons
    'input invalid '                                                 + // form elements
    'touchstart touchmove touchend touchcancel '                     + // touch
    'gesturestart gesturechange gestureend '                         + // gesture
    'textinput '                                                     + // TextEvent
    'readystatechange pageshow pagehide popstate '                   + // window
    'hashchange offline online '                                     + // window
    'afterprint beforeprint '                                        + // printing
    'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd
    'loadstart progress suspend emptied stalled loadmetadata '       + // media
    'loadeddata canplay canplaythrough playing waiting seeking '     + // media
    'seeked ended durationchange timeupdate play pause ratechange '  + // media
    'volumechange cuechange '                                        + // media
    'checking noupdate downloading cached updateready obsolete '       // appcache

    // convert to a hash for quick lookups
    , nativeEvents = (function (hash, events, i) {
      for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)
      return hash
    }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))

  // custom events are events that we *fake*, they are not provided natively but
  // we can use native events to generate them
  , customEvents = (function () {
    var isAncestor = 'compareDocumentPosition' in root
    ? function (element, container) {
      return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16
    }
    : 'contains' in root
    ? function (element, container) {
      container = container.nodeType === 9 || container === window ? root : container
      return container !== element && container.contains(element)
    }
    : function (element, container) {
      while (element = element.parentNode) if (element === container) return 1
      return 0
    }
    , check = function (event) {
      var related = event.relatedTarget
      return !related
      ? related == null
      : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())
        && !isAncestor(related, this))
    }

    return {
      mouseenter: { base: 'mouseover', condition: check }
      , mouseleave: { base: 'mouseout', condition: check }
      , mousewheel: { base: /Firefox/.test(navigator.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }
    }
  }())

// we provide a consistent Event object across browsers by taking the actual DOM
// event object and generating a new one from its properties.
, Event = (function () {
  // a whitelist of properties (for different event types) tells us what to check for and copy
  var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +
    'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +
    'srcElement target timeStamp type view which propertyName')
  , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +
    'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))
  , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +
    'axis')) // 'axis' is FF specific
  , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +
    'keyLocation location'))
  , textProps    = commonProps.concat(str2arr('data'))
  , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))
  , messageProps = commonProps.concat(str2arr('data origin source'))
  , stateProps   = commonProps.concat(str2arr('state'))
  , overOutRegex = /over|out/
  // some event types need special handling and some need special properties, do that all here
  , typeFixers   = [
  { // key events
    reg: /key/i
      , fix: function (event, newEvent) {
        newEvent.keyCode = event.keyCode || event.which
        return keyProps
      }
  }
  , { // mouse events
    reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i
      , fix: function (event, newEvent, type) {
        newEvent.rightClick = event.which === 3 || event.button === 2
        newEvent.pos = { x: 0, y: 0 }
        if (event.pageX || event.pageY) {
          newEvent.clientX = event.pageX
          newEvent.clientY = event.pageY
        } else if (event.clientX || event.clientY) {
          newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft
          newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop
        }
        if (overOutRegex.test(type)) {
          newEvent.relatedTarget = event.relatedTarget
          || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']
        }
        return mouseProps
      }
  }
  , { // mouse wheel events
    reg: /mouse.*(wheel|scroll)/i
      , fix: function () { return mouseWheelProps }
  }
  , { // TextEvent
    reg: /^text/i
      , fix: function () { return textProps }
  }
  , { // touch and gesture events
    reg: /^touch|^gesture/i
      , fix: function () { return touchProps }
  }
  , { // message events
    reg: /^message$/i
      , fix: function () { return messageProps }
  }
  , { // popstate events
    reg: /^popstate$/i
      , fix: function () { return stateProps }
  }
  , { // everything else
    reg: /.*/
  , fix: function () { return commonProps }
  }
  ]
  , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism

  , Event = function (event, element, isNative) {
    if (!arguments.length) return
    event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event
    this.originalEvent = event
    this.isNative       = isNative
    this.isBean         = true

    if (!event) return

    var type   = event.type
    , target = event.target || event.srcElement
    , i, l, p, props, fixer

    this.target = target && target.nodeType === 3 ? target.parentNode : target

    if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless
      fixer = typeFixerMap[type]
      if (!fixer) { // haven't encountered this event type before, map a fixer function for it
        for (i = 0, l = typeFixers.length; i < l; i++) {
          if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*
            typeFixerMap[type] = fixer = typeFixers[i].fix
            break
          }
        }
      }

      props = fixer(event, this, type)
      for (i = props.length; i--;) {
        if (!((p = props[i]) in this) && p in event) this[p] = event[p]
      }
    }
  }

  // preventDefault() and stopPropagation() are a consistent interface to those functions
  // on the DOM, stop() is an alias for both of them together
  Event.prototype.preventDefault = function () {
    if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()
    else this.originalEvent.returnValue = false
  }
  Event.prototype.stopPropagation = function () {
    if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()
    else this.originalEvent.cancelBubble = true
  }
  Event.prototype.stop = function () {
    this.preventDefault()
    this.stopPropagation()
    this.stopped = true
  }
  // stopImmediatePropagation() has to be handled internally because we manage the event list for
  // each element
  // note that originalElement may be a Bean#Event object in some situations
  Event.prototype.stopImmediatePropagation = function () {
    if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()
    this.isImmediatePropagationStopped = function () { return true }
  }
  Event.prototype.isImmediatePropagationStopped = function () {
    return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()
  }
  Event.prototype.clone = function (currentTarget) {
    //TODO: this is ripe for optimisation, new events are *expensive*
    // improving this will speed up delegated events
    var ne = new Event(this, this.element, this.isNative)
    ne.currentTarget = currentTarget
    return ne
  }

  return Event
}())

        // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both
        , targetElement = function (element, isNative) {
          return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element
        }

        /**
         * Bean maintains an internal registry for event listeners. We don't touch elements, objects
         * or functions to identify them, instead we store everything in the registry.
         * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.
         */
        , RegEntry = (function () {
          // each handler is wrapped so we can handle delegation and custom events
          var wrappedHandler = function (element, fn, condition, args) {
            var call = function (event, eargs) {
              return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)
            }
            , findTarget = function (event, eventElement) {
              return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement
            }
            , handler = condition
            ? function (event) {
              var target = findTarget(event, this) // deleated event
              if (condition.apply(target, arguments)) {
                if (event) event.currentTarget = target
                return call(event, arguments)
              }
            }
            : function (event) {
              if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix
              return call(event, arguments)
            }
            handler.__beanDel = fn.__beanDel
            return handler
          }

          , RegEntry = function (element, type, handler, original, namespaces, args, root) {
            var customType     = customEvents[type]
            , isNative

            if (type == 'unload') {
              // self clean-up
              handler = once(removeListener, element, type, handler, original)
            }

            if (customType) {
              if (customType.condition) {
                handler = wrappedHandler(element, handler, customType.condition, args)
              }
              type = customType.base || type
            }

            this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]
            this.customType    = !W3C_MODEL && !isNative && type
            this.element       = element
            this.type          = type
            this.original      = original
            this.namespaces    = namespaces
            this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'
            this.target        = targetElement(element, isNative)
            this[eventSupport] = !!this.target[eventSupport]
            this.root          = root
            this.handler       = wrappedHandler(element, handler, null, args)
          }

          // given a list of namespaces, is our entry in any of them?
          RegEntry.prototype.inNamespaces = function (checkNamespaces) {
            var i, j, c = 0
            if (!checkNamespaces) return true
            if (!this.namespaces) return false
            for (i = checkNamespaces.length; i--;) {
              for (j = this.namespaces.length; j--;) {
                if (checkNamespaces[i] == this.namespaces[j]) c++
              }
            }
            return checkNamespaces.length === c
          }

          // match by element, original fn (opt), handler fn (opt)
          RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {
            return this.element === checkElement &&
              (!checkOriginal || this.original === checkOriginal) &&
            (!checkHandler || this.handler === checkHandler)
          }

          return RegEntry
        }())

      , registry = (function () {
        // our map stores arrays by event type, just because it's better than storing
        // everything in a single array.
        // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for
        // rootListeners so we can look them up fast
        var map = {}

        // generic functional search of our registry for matching listeners,
        // `fn` returns false to break out of the loop
        , forAll = function (element, type, original, handler, root, fn) {
          var pfx = root ? 'r' : '$'
          if (!type || type == '*') {
            // search the whole registry
            for (var t in map) {
              if (t.charAt(0) == pfx) {
                forAll(element, t.substr(1), original, handler, root, fn)
              }
            }
          } else {
            var i = 0, l, list = map[pfx + type], all = element == '*'
            if (!list) return
            for (l = list.length; i < l; i++) {
              if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return
            }
          }
        }

        , has = function (element, type, original, root) {
          // we're not using forAll here simply because it's a bit slower and this
          // needs to be fast
          var i, list = map[(root ? 'r' : '$') + type]
          if (list) {
            for (i = list.length; i--;) {
              if (!list[i].root && list[i].matches(element, original, null)) return true
            }
          }
          return false
        }

        , get = function (element, type, original, root) {
          var entries = []
          forAll(element, type, original, null, root, function (entry) {
            return entries.push(entry)
          })
        return entries
        }

        , put = function (entry) {
          var has = !entry.root && !this.has(entry.element, entry.type, null, false)
          , key = (entry.root ? 'r' : '$') + entry.type
          ;(map[key] || (map[key] = [])).push(entry)
          return has
        }

        , del = function (entry) {
          forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {
            list.splice(i, 1)
            entry.removed = true
            if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]
            return false
          })
        }

        // dump all entries, used for onunload
        , entries = function () {
          var t, entries = []
          for (t in map) {
            if (t.charAt(0) == '$') entries = entries.concat(map[t])
          }
          return entries
        }

        return { has: has, get: get, put: put, del: del, entries: entries }
      }())

    // we need a selector engine for delegated events, use querySelectorAll if it exists
    // but for older browsers we need Qwery, Sizzle or similar
    , selectorEngine
    , setSelectorEngine = function (e) {
      if (!arguments.length) {
        selectorEngine = doc.querySelectorAll
        ? function (s, r) {
          return r.querySelectorAll(s)
        }
        : function () {
          throw new Error('Bean: No selector engine installed') // eeek
        }
      } else {
        selectorEngine = e
      }
    }

    // we attach this listener to each DOM event that we need to listen to, only once
    // per event type per DOM element
    , rootListener = function (event, type) {
      if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return

      var listeners = registry.get(this, type || event.type, null, false)
      , l = listeners.length
      , i = 0

      event = new Event(event, this, true)
      if (type) event.type = type

      // iterate through all handlers registered for this type, calling them unless they have
      // been removed by a previous handler or stopImmediatePropagation() has been called
      for (; i < l && !event.isImmediatePropagationStopped(); i++) {
        if (!listeners[i].removed) listeners[i].handler.call(this, event)
      }
    }

    // add and remove listeners to DOM elements
    , listener = W3C_MODEL
    ? function (element, type, add) {
      // new browsers
      element[add ? addEvent : removeEvent](type, rootListener, false)
    }
    : function (element, type, add, custom) {
      // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events
      // to simulate event bubbling etc.
      var entry
      if (add) {
        registry.put(entry = new RegEntry(
          element
          , custom || type
          , function (event) { // handler
            rootListener.call(element, event, custom)
          }
          , rootListener
          , null
          , null
          , true // is root
          ))
        if (custom && element['_on' + custom] == null) element['_on' + custom] = 0
        entry.target.attachEvent('on' + entry.eventType, entry.handler)
      } else {
        entry = registry.get(element, custom || type, rootListener, true)[0]
        if (entry) {
          entry.target.detachEvent('on' + entry.eventType, entry.handler)
          registry.del(entry)
        }
      }
    }

    , once = function (rm, element, type, fn, originalFn) {
      // wrap the handler in a handler that does a remove as well
      return function () {
        fn.apply(this, arguments)
        rm(element, type, originalFn)
      }
    }

    , removeListener = function (element, orgType, handler, namespaces) {
      var type     = orgType && orgType.replace(nameRegex, '')
      , handlers = registry.get(element, type, null, false)
      , removed  = {}
      , i, l

      for (i = 0, l = handlers.length; i < l; i++) {
        if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {
          // TODO: this is problematic, we have a registry.get() and registry.del() that
          // both do registry searches so we waste cycles doing this. Needs to be rolled into
          // a single registry.forAll(fn) that removes while finding, but the catch is that
          // we'll be splicing the arrays that we're iterating over. Needs extra tests to
          // make sure we don't screw it up. @rvagg
          registry.del(handlers[i])
          if (!removed[handlers[i].eventType] && handlers[i][eventSupport])
          removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }
        }
      }
      // check each type/element for removed listeners and remove the rootListener where it's no longer needed
      for (i in removed) {
        if (!registry.has(element, removed[i].t, null, false)) {
          // last listener of this type, remove the rootListener
          listener(element, removed[i].t, false, removed[i].c)
        }
      }
    }

    // set up a delegate helper using the given selector, wrap the handler function
    , delegate = function (selector, fn) {
      //TODO: findTarget (therefore $) is called twice, once for match and once for
      // setting e.currentTarget, fix this so it's only needed once
      var findTarget = function (target, root) {
        var i, array = isString(selector) ? selectorEngine(selector, root) : selector
        for (; target && target !== root; target = target.parentNode) {
          for (i = array.length; i--;) {
            if (array[i] === target) return target
          }
        }
      }
      , handler = function (e) {
        var match = findTarget(e.target, this)
        if (match) fn.apply(match, arguments)
      }

      // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean
      handler.__beanDel = {
        ft       : findTarget // attach it here for customEvents to use too
        , selector : selector
      }
      return handler
    }

    , fireListener = W3C_MODEL ? function (isNative, type, element) {
      // modern browsers, do a proper dispatchEvent()
      var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')
      evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)
      element.dispatchEvent(evt)
    } : function (isNative, type, element) {
      // old browser use onpropertychange, just increment a custom property to trigger the event
      element = targetElement(element, isNative)
      isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++
    }

    /**
     * Public API: off(), on(), add(), (remove()), one(), fire(), clone()
     */

    /**
     * off(element[, eventType(s)[, handler ]])
     */
    , off = function (element, typeSpec, fn) {
      var isTypeStr = isString(typeSpec)
      , k, type, namespaces, i

      if (isTypeStr && typeSpec.indexOf(' ') > 0) {
        // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')
        typeSpec = str2arr(typeSpec)
        for (i = typeSpec.length; i--;)
        off(element, typeSpec[i], fn)
        return element
      }

      type = isTypeStr && typeSpec.replace(nameRegex, '')
      if (type && customEvents[type]) type = customEvents[type].base

      if (!typeSpec || isTypeStr) {
        // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)
        if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')
        removeListener(element, type, fn, namespaces)
      } else if (isFunction(typeSpec)) {
        // off(el, fn)
        removeListener(element, null, typeSpec)
      } else {
        // off(el, { t1: fn1, t2, fn2 })
        for (k in typeSpec) {
          if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])
        }
      }

      return element
    }

    /**
     * on(element, eventType(s)[, selector], handler[, args ])
     */
    , on = function(element, events, selector, fn) {
      var originalFn, type, types, i, args, entry, first

      //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?
      if (selector === undefined && typeof events == 'object') {
        //TODO: this can't handle delegated events
        for (type in events) {
          if (events.hasOwnProperty(type)) {
            on.call(this, element, type, events[type])
          }
        }
        return
      }

      if (!isFunction(selector)) {
        // delegated event
        originalFn = fn
        args       = slice.call(arguments, 4)
        fn         = delegate(selector, originalFn, selectorEngine)
      } else {
        args       = slice.call(arguments, 3)
        fn         = originalFn = selector
      }

      types = str2arr(events)

      // special case for one(), wrap in a self-removing handler
      if (this === ONE) {
        fn = once(off, element, events, fn, originalFn)
      }

      for (i = types.length; i--;) {
        // add new handler to the registry and check if it's the first for this element/type
        first = registry.put(entry = new RegEntry(
          element
          , types[i].replace(nameRegex, '') // event type
          , fn
          , originalFn
          , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces
          , args
          , false // not root
          ))
        if (entry[eventSupport] && first) {
          // first event of this type on this element, add root listener
          listener(element, entry.eventType, true, entry.customType)
        }
      }

      return element
    }

    /**
     * add(element[, selector], eventType(s), handler[, args ])
     *
     * Deprecated: kept (for now) for backward-compatibility
     */
    , add = function (element, events, fn, delfn) {
      return on.apply(
        null
        , !isString(fn)
        ? slice.call(arguments)
        : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])
        )
    }

    /**
     * one(element, eventType(s)[, selector], handler[, args ])
     */
    , one = function () {
      return on.apply(ONE, arguments)
    }

    /**
     * fire(element, eventType(s)[, args ])
     *
     * The optional 'args' argument must be an array, if no 'args' argument is provided
     * then we can use the browser's DOM event system, otherwise we trigger handlers manually
     */
    , fire = function (element, type, args) {
      var types = str2arr(type)
      , i, j, l, names, handlers

      for (i = types.length; i--;) {
        type = types[i].replace(nameRegex, '')
        if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')
        if (!names && !args && element[eventSupport]) {
          fireListener(nativeEvents[type], type, element)
        } else {
          // non-native event, either because of a namespace, arguments or a non DOM element
          // iterate over all listeners and manually 'fire'
          handlers = registry.get(element, type, null, false)
          args = [false].concat(args)
          for (j = 0, l = handlers.length; j < l; j++) {
               if (handlers[j].inNamespaces(names)) {
               handlers[j].handler.apply(element, args)
               }
               }
               }
               }
               return element
               }

               /**
               * clone(dstElement, srcElement[, eventType ])
               *
               * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?
               */
               , clone = function (element, from, type) {
               var handlers = registry.get(from, type, null, false)
               , l = handlers.length
               , i = 0
               , args, beanDel

               for (; i < l; i++) {
               if (handlers[i].original) {
               args = [ element, handlers[i].type ]
               if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)
               args.push(handlers[i].original)
               on.apply(null, args)
               }
               }
               return element
               }

               , bean = {
               'on'                : on
               , 'add'               : add
               , 'one'               : one
               , 'off'               : off
               , 'remove'            : off
               , 'clone'             : clone
               , 'fire'              : fire
               , 'Event'             : Event
               , 'setSelectorEngine' : setSelectorEngine
               , 'noConflict'        : function () {
               context[name] = old
               return this
               }
               }

               // for IE, clean up on unload to avoid leaks
               if (win.attachEvent) {
               var cleanup = function () {
               var i, entries = registry.entries()
               for (i in entries) {
               if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)
               }
               win.detachEvent('onunload', cleanup)
               win.CollectGarbage && win.CollectGarbage()
               }
               win.attachEvent('onunload', cleanup)
               }

               // initialize selector engine to internal default (qSA or throw Error)
               setSelectorEngine()

               return bean
               });


               /***/ }
               /******/ ])
               });
               ;
               </script>


  

  <script>
  var menu = document.querySelectorAll('[data-hamburger-menu]')[0]
  var openMenu = document.querySelectorAll('[data-open-hamburger-menu]')[0]
  var closeMenu = document.querySelectorAll('[data-close-hamburger-menu]')[0]
  var body = document.body

  openMenu.onclick = toggleMenu.bind(this, true);
  closeMenu.onclick = toggleMenu.bind(this, false);

  function toggleMenu(show) {
    toggleElements([openMenu], !show);
    toggleElements([menu, closeMenu], show);
    toggleScrolling(body, show);
  }

  function toggleElements(elements, show) {
    elements.forEach(function(element) {
      if (show) {
        element.classList.remove("hidden")
        element.classList.add("block");
      } else {
        element.classList.remove("block")
        element.classList.add("hidden");
      }
    })
  }

  function toggleScrolling(element, scrollDisabled) {
    var classes = ["scrolling-auto", "overflow-hidden", "fixed", "pin-x"];
    if (scrollDisabled) {
      classes.forEach(function(klass){
        element.classList.add(klass);
      })
    } else {
      classes.forEach(function(klass){
        element.classList.remove(klass);
      })
    }
  }

  var anchors = new AnchorJS();
  anchors.options = {
    placement: 'left'
  }
  anchors.add()

  var timeAgoElement = document.querySelector("[data-js-time-ago]")
  var ta = timeago();
  var url = window.location.pathname

  if (timeAgoElement && timeAgoElement.innerHTML.match(/\w/)) {
    var ago = ta.ago(timeAgoElement.innerHTML + " 12:00:00", true);
    var span = document.createElement('span');

    span.innerHTML = "(" + ago + " ago)";
    timeAgoElement.appendChild(span);
  }

  var updateKudos = function(count) {
    document.querySelector("[data-js-kudos-count]").innerHTML = count;
  }

  if (window.location.hostname !== "localhost") {
    fetch("https://backend.shime.sh/analytics", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ "url": url })
    }).then(function(response) {
      return response.json()
    }).then(function(body) {
      if (window.location.search.match(/analytics/)) {
        var container = document.querySelector("[data-js-views-container]");
        var views = document.querySelector("[data-js-views]");
        views.innerHTML = body.pageviews;

        container.classList.remove("hidden");
      }

      if (typeof(kudos) !== "undefined") {
        updateKudos(body.kudos);

        var k = kudos(document.querySelector('.kudo'),{
          // set initial state(true:already kudoed.)
          state: localStorage.getItem(url),
          // on kudo
          onkudo:function(next) {
            localStorage.setItem(url, true);

            fetch("https://backend.shime.sh/kudos", {
              method: "POST",
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ "url": window.location.pathname })
            }).then(function(response) {
              return response.json()
            }).then(function(body){
              updateKudos(body.kudos);
              next();
            });
          }
        });
      }
    });
  }
</script>

</html>
