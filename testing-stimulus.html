<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="//gmpg.org/xfn/11" rel="profile">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/monokai.css?1593683762750399000">
  <link rel="stylesheet" href="/public/css/style.css?1593683762750399000">

  <link rel="icon" sizes="16x16 32x32 64x64" href="/public/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="/public/favicon-196.png">
<link rel="icon" type="image/png" sizes="160x160" href="/public/favicon-160.png">
<link rel="icon" type="image/png" sizes="128x128" href="/public/favicon-128.png">
<link rel="icon" type="image/png" sizes="96x96" href="/public/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="/public/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16.png">
<link rel="apple-touch-icon" href="/public/favicon-57.png">
<link rel="apple-touch-icon" sizes="180x180" href="/public/favicon-180.png">
<link rel="apple-touch-icon" sizes="152x152" href="/public/favicon-152.png">
<link rel="apple-touch-icon" sizes="144x144" href="/public/favicon-144.png">
<link rel="apple-touch-icon" sizes="120x120" href="/public/favicon-120.png">
<link rel="apple-touch-icon" sizes="114x114" href="/public/favicon-114.png">
<link rel="apple-touch-icon" sizes="76x76" href="/public/favicon-76.png">
<link rel="apple-touch-icon" sizes="72x72" href="/public/favicon-72.png">
<link rel="apple-touch-icon" sizes="60x60" href="/public/favicon-60.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="/public/favicon-144.png">
<meta name="msapplication-config" content="/public/browserconfig.xml">


  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Testing Stimulus" />
<meta name="author" content="Hrvoje Šimić" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Since the official Stimulus handbook doesn&#39;t include testing, and I recently had to cover a Stimulus controller with tests, I&#39;d like to share my approach." />
<meta property="og:description" content="Since the official Stimulus handbook doesn&#39;t include testing, and I recently had to cover a Stimulus controller with tests, I&#39;d like to share my approach." />
<link rel="canonical" href="http://shime.sh/testing-stimulus" />
<meta property="og:url" content="http://shime.sh/testing-stimulus" />
<meta property="og:site_name" content="Hrvoje Šimić" />
<meta property="og:image" content="http://shime.sh/public/social.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-19T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="http://shime.sh/public/social.jpg" />
<meta property="twitter:title" content="Testing Stimulus" />
<meta name="twitter:site" content="@shime_sh" />
<meta name="twitter:creator" content="@shime_sh" />
<script type="application/ld+json">
{"headline":"Testing Stimulus","dateModified":"2019-01-19T00:00:00+01:00","url":"http://shime.sh/testing-stimulus","datePublished":"2019-01-19T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://shime.sh/testing-stimulus"},"author":{"@type":"Person","name":"Hrvoje Šimić"},"description":"Since the official Stimulus handbook doesn&#39;t include testing, and I recently had to cover a Stimulus controller with tests, I&#39;d like to share my approach.","@type":"BlogPosting","image":"http://shime.sh/public/social.jpg","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  
    <title> Testing Stimulus &middot; Hrvoje Šimić </title>
  

  <meta name="title" content="Testing Stimulus &middot; Hrvoje Šimić">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>

  
</head>


  <body class="font-sans">
    <div class="lg:pt-16 lg:pb-32 p-6 relative">
      




<div class="relative flex justify-between items-start w-full z-20 md:justify-center self-center">
  <div class="flex items-center">
    <a class="self-start w-16 h-16" href="/">
      <img class="self-start rounded-full w-16 h-16" src='/public/shime.jpg' alt='' />
    </a>

    <div class="flex flex-col ml-4">
      <a class="text-black font-bold text-xl no-underline font-extrabold self-start" href="/">Hrvoje Šimić</a>
      <a class="text-black font-bold no-underline font-extrabold my-1 self-start" href="https://twitter.com/shime_sh">@shime_sh</a>
      <ul class="hidden md:block list-reset tracking-wide">
        
        <li class="inline">
          
            <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-blue-light" href='/articles/'>Articles</a>
          
        </li>
        
        <li class="inline">
          
            <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-blue-light" href='/til/'>TIL</a>
          
        </li>
        
        <li class="inline">
          
            <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-blue-light" href='/photography/'>Photography</a>
          
        </li>
        
        <li class="inline">
          
            <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-blue-light" href='/reading/'>Reading list</a>
          
        </li>
        
        <li class="inline">
          
            <a class="font-medium text-xs text-grey no-underline uppercase mr-2 hover:text-blue-light" href='/subscribe'>Subscribe</a>
          
        </li>
        
      </ul>
    </div>
  </div>

  <div class="block md:hidden self-center">
    <button data-open-hamburger-menu="true">
      <svg height="32" width="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path fill="black" class="heroicon-ui" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
      </svg>
    </button>

    <button data-close-hamburger-menu="true" class="hidden">
      <svg fill="black" height="32" id="close" viewBox="0 0 32 32" width="32" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 8 L8 4 L16 12 L24 4 L28 8 L20 16 L28 24 L24 28 L16 20 L8 28 L4 24 L12 16 z"/>
      </svg>
    </button>
  </div>
</div>

<div class="hidden md:hidden fixed pin bg-white z-10 mt-32 pt-12" data-hamburger-menu="true">
  <ul class="list-reset tracking-wide flex flex-col items-center w-full">
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-black no-underline uppercase" href='/articles/'>Articles</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-black no-underline uppercase" href='/til/'>TIL</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-black no-underline uppercase" href='/photography/'>Photography</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-black no-underline uppercase" href='/reading/'>Reading list</a>
      
    </li>
    

    <li class="my-2">
      
        <a class="font-semibold text-xl text-black no-underline uppercase" href='/subscribe'>Subscribe</a>
      
    </li>
    
  </ul>
</div>


      <div class="w-full flex justify-center text-lg mt-16 text-grey-darker font-light leading-normal">
        <div class="flex-col">
          <div class="max-w-full">
            

          </div>

          <div class="post max-w-full md:max-w-md">
            
            

            
            <div>
              <a class="no-underline uppercase text-sm" href="/articles"> ← articles </a>
            </div>
            
            <div class="mb-8">
              <h1>Testing Stimulus</h1>
              
              <div class="text-grey">
                January 19, 2019
              </div>
              

              <div class="flex my-2">
                
                  <span class="bg-blue-lightest py-1 px-2 text-center text-blue-dark mr-2 rounded text-sm">
                    stimulus
                  </span>
                
              </div>
            </div>

            <p>Since the <a href="https://stimulusjs.org/handbook/origin">official Stimulus handbook</a>
doesn&#39;t include testing, and I recently had to cover a Stimulus controller with tests,
I&#39;d like to share my approach.</p>

<h2>Install dependencies</h2>

<p>The first step is installing the required
npm packages to make this work.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>yarn add --dev jest
yarn add --dev babel-jest babel-preset-es2015
yarn add --dev mutationobserver-shim
</code></pre></div>
<p>We&#39;re going to use Jest for testing; Babel packages to make it play nice with
Jest and mutationobserver-shim for shimming <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver</a>
API which is required by Stimulus. We need that shim since
Jest uses jsdom by default and jsdom doesn&#39;t have support
for MutationObserver as of this writing.</p>

<h2>Instruct Jest to use the MutationObserver shim</h2>

<p>Place this in <code>./test/javascript/setup.js</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="c1">// Setup MutationObserver shim since jsdom doesn&#39;t</span>
<span class="c1">// support it out of the box.</span>

<span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">shim</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span>
 <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
    <span class="s2">&quot;node_modules&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mutationobserver-shim&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mutationobserver.min.js&quot;</span>
  <span class="p">),</span>
  <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s2">&quot;utf-8&quot;</span> <span class="p">}</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span>
<span class="nx">script</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">shim</span><span class="p">;</span>

<span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</code></pre></div>
<p>We need to tell Jest to lookup this file before
each test and execute it. Place this in <code>package.json</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span> <span class="s2">&quot;jest&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;testRegex&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;test/javascript/.*_test\\.js&quot;</span><span class="p">],</span>
   <span class="s2">&quot;setupFiles&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="s2">&quot;./test/javascript/setup.js&quot;</span>
   <span class="p">]</span>
 <span class="p">}</span>
</code></pre></div>
<p>The <code>&quot;jest&quot;</code> property should be added to the top level.</p>

<h2>Write your first test</h2>

<p>Now that we have our shim in place, we need to write
our first failing test.</p>

<p>We need to set up Babel to play nice with Jest first.
To do that, add <code>&quot;es2015&quot;</code> to <code>&quot;presets&quot;</code>.
Place this in your <code>.babelrc</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="p">{</span> <span class="s2">&quot;presets&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div>
<p>Place this in <code>test/javascript/first_test.js</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Failing test&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Fails spectacularly&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>And run it with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>yarn run jest test/javascript/first_test.js
</code></pre></div>
<p>Congrats, you should see your first test fail! Woohoo!</p>

<p>If you have some linter running, it will
complain about <code>&quot;describe&quot;</code> and <code>&quot;it&quot;</code>. In my
case that was <code>eslint</code>, so I had to place this
in <code>.eslintrc</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">env</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">jest</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="c1">// rest of env config</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Once you have set that up, let&#39;s fix our failing test.
Replace your <code>test/javascript/first_test.js</code> with:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Passes spectacularly&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Run it with the same command:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>yarn run jest test/javascript/first_test.js
</code></pre></div>
<p>And you should see the test passing.</p>

<h2>Write a Stimulus controller test</h2>

<p>Now that we&#39;ve written the trivial assertion let&#39;s
get serious and write a real Stimulus controller test.</p>

<p>Put this in <code>test/javascript/basic_controller_test.js</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Application</span><span class="p">,</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">BasicController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">];</span>

  <span class="nx">copy</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;BasicController&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;#copy&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`&lt;div data-controller=&quot;basic&quot;&gt;</span>
<span class="sb">        &lt;input id=&quot;input&quot; data-target=&quot;basic.input&quot; /&gt;</span>
<span class="sb">        &lt;input id=&quot;output&quot; data-target=&quot;basic.output&quot; /&gt;</span>
<span class="sb">        &lt;button id=&quot;button&quot; data-action=&quot;basic#copy&quot; /&gt;</span>
<span class="sb">      &lt;/div&gt;`</span><span class="p">;</span>

      <span class="kr">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span> <span class="nx">BasicController</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;copies input and sets it on output&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">);</span>

      <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
      <span class="nx">button</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>

      <span class="nx">expect</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>And run it with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>yarn run jest test/javascript/basic_controller_test.js
</code></pre></div>
<p>This test should fail, which means you have just
written your first failing Stimulus test.</p>

<p>To make it pass, replace the expected value to <code>&quot;foo&quot;</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Application</span><span class="p">,</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">BasicController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">];</span>

  <span class="nx">copy</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;BasicController&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;#copy&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`&lt;div data-controller=&quot;basic&quot;&gt;</span>
<span class="sb">        &lt;input id=&quot;input&quot; data-target=&quot;basic.input&quot; /&gt;</span>
<span class="sb">        &lt;input id=&quot;output&quot; data-target=&quot;basic.output&quot; /&gt;</span>
<span class="sb">        &lt;button id=&quot;button&quot; data-action=&quot;basic#copy&quot; /&gt;</span>
<span class="sb">      &lt;/div&gt;`</span><span class="p">;</span>

      <span class="kr">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span> <span class="nx">BasicController</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;copies input and sets it on output&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">);</span>

      <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
      <span class="nx">button</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>

      <span class="c1">// This line has changed its expectations.</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>Congrats! This test should pass now, which means you
have just written your first passing Stimulus controller test.</p>

<h2>Write a more complex Stimulus controller test</h2>

<p>It&#39;s time to write something more complex; real Stimulus controllers
usually do something more complicated than copying a value from
one input to another. Like copying a value from input to a paragraph.
It can&#39;t get more complicated than that! Just kidding, I&#39;d like to show
how to handle some non-default actions with this example.</p>

<p>Put this in <code>test/javascript/advanced_controller_test.js</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Application</span><span class="p">,</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AdvancedController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">];</span>

  <span class="nx">valueChanged</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">).</span>
      <span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Some input has changed its value&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">changeValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">eventType</span><span class="p">);</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;AdvancedController&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;#valueChanged&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`&lt;div data-controller=&quot;advanced&quot;&gt;</span>
<span class="sb">        &lt;input id=&quot;input&quot; data-action=&quot;keyup-&gt;advanced#valueChanged&quot;/&gt;</span>

<span class="sb">        &lt;p id=&quot;result&quot; data-target=&quot;advanced.result&quot;/&gt;</span>
<span class="sb">      &lt;/div&gt;`</span><span class="p">;</span>

      <span class="kr">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span> <span class="nx">AdvancedController</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;copies input and sets it on output&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">);</span>

      <span class="nx">changeValue</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">);</span>

      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">).</span>
        <span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;This will fail, right?&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>And run it with Jest again:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>yarn run jest test/javascript/advanced_controller_test.js
</code></pre></div>
<p>Congrats if it fails! Change the expectation to match the actual
text inside a paragraph.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Application</span><span class="p">,</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AdvancedController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">];</span>

  <span class="nx">valueChanged</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">).</span>
      <span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Some input has changed its value&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">changeValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">eventType</span><span class="p">);</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;AdvancedController&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;#valueChanged&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`&lt;div data-controller=&quot;advanced&quot;&gt;</span>
<span class="sb">        &lt;input id=&quot;input&quot; data-action=&quot;keyup-&gt;advanced#valueChanged&quot;/&gt;</span>

<span class="sb">        &lt;p id=&quot;result&quot; data-target=&quot;advanced.result&quot;/&gt;</span>
<span class="sb">      &lt;/div&gt;`</span><span class="p">;</span>

      <span class="kr">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span> <span class="nx">AdvancedController</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;copies input and sets it on output&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">);</span>

      <span class="nx">changeValue</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">);</span>

      <span class="c1">// This line has changed its expectations.</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">).</span>
        <span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;Some input has changed its value&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>The test should pass now.</p>

<p>Note how we needed to explicitly dispatch the type of event
we wanted on the input element. We need to do that for any
event when testing Stimulus controllers. We had used the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/click"><code>HTMLElement.click()</code></a> helper
in the basic test for simulating a click on an element, but unfortunately those helpers don&#39;t exist for most of the other events.</p>

<h2>Configure your environment for the real world</h2>

<p>Now that you know how to test a Stimulus controller,
you might be interested in how to set up your environment
for testing your Stimulus application.</p>

<p>You probably don&#39;t write Stimulus controllers in your
test files, as we did here, so you&#39;ll need to instruct
Jest how to import those controllers.  I&#39;m going to assume your 
Stimulus controllers are located in <code>app/javascript/controllers</code>.</p>

<p>To tell Jest where to look for your controllers,
use <code>&quot;moduleDirectories&quot;</code> property in Jest configuration.</p>

<p>You also probably want to run all your JavaScript tests
with a single command, since you&#39;ll probably end up
with one test file per controller. I&#39;m going to assume your
JavaScript tests are in <code>test/javascript</code> and each test ends
with <code>_test.js</code>.</p>

<p>To tell Jest where to look for your tests, use
<code>&quot;roots&quot;</code> and <code>&quot;testRegex&quot;</code> properties in Jest configuration.</p>

<p>Here&#39;s how that Jest configuration would look like in <code>package.json</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="s2">&quot;jest&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;setupFiles&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;./test/javascript/setup.js&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;testRegex&quot;</span><span class="o">:</span> <span class="s2">&quot;.*_test.js&quot;</span><span class="p">,</span>
  <span class="s2">&quot;roots&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;test/javascript&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;moduleDirectories&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;node_modules&quot;</span><span class="p">,</span>
    <span class="s2">&quot;app/javascript/controllers&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>Let&#39;s say we have moved our <code>AdvancedController</code> from the test file
to <code>app/javascript/controllers/advanced_controller.js</code> and added
the correct export to the end of that file:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">AdvancedController</span> <span class="kr">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="c1">// rest of the controller copied from the test</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">AdvancedController</span><span class="p">;</span>
</code></pre></div>
<p>The <code>&quot;moduleDirectories&quot;</code> property enables us to import those
Stimulus controllers very easily in tests now:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Application</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;stimulus&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AdvancedController</span> <span class="nx">from</span> <span class="s2">&quot;advanced_controller&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">changeValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">eventType</span><span class="p">);</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;AdvancedController&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;#valueChanged&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`&lt;div data-controller=&quot;advanced&quot;&gt;</span>
<span class="sb">        &lt;input id=&quot;input&quot; data-action=&quot;keyup-&gt;advanced#valueChanged&quot;/&gt;</span>

<span class="sb">        &lt;p id=&quot;result&quot; data-target=&quot;advanced.result&quot;/&gt;</span>
<span class="sb">      &lt;/div&gt;`</span><span class="p">;</span>

      <span class="kr">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span> <span class="nx">AdvancedController</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;copies input and sets it on output&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">);</span>

      <span class="nx">changeValue</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">);</span>

      <span class="c1">// This line has changed its expectations.</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">).</span>
        <span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;Some input has changed its value&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>We can also run all our JavaScript tests with a single command,
by configuring the standard <code>&quot;scripts&quot;</code> property in <code>package.json</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;jest&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>We can now run JavaScript tests with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>yarn <span class="nb">test</span>
</code></pre></div>
<h2>Set up Rake to run JavaScript tests</h2>

<p>If you&#39;re using Rails, you probably run all your tests
with <code>rake</code>. To include JavaScript tests in your default task,
add this to your <code>Rakefile</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">task</span> <span class="ss">default</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;test:system&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test:js&#39;</span><span class="o">]</span>

<span class="n">namespace</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:js</span> <span class="k">do</span>
    <span class="n">sh</span> <span class="s1">&#39;yarn test&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>It&#39;s so easy to run JavaScript tests now with:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>rake test:js
</code></pre></div>
<p>Or all tests with:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>rake
</code></pre></div>
<p>That&#39;s it; you&#39;re now ready to test your 
Stimulus controllers!</p>


            <hr />
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
  var menu = document.querySelectorAll('[data-hamburger-menu]')[0]
  var openMenu = document.querySelectorAll('[data-open-hamburger-menu]')[0]
  var closeMenu = document.querySelectorAll('[data-close-hamburger-menu]')[0]
  var body = document.body

  openMenu.onclick = toggleMenu.bind(this, true);
  closeMenu.onclick = toggleMenu.bind(this, false);

  function toggleMenu(show) {
    toggleElements([openMenu], !show);
    toggleElements([menu, closeMenu], show);
    toggleScrolling(body, show);
  }

  function toggleElements(elements, show) {
    elements.forEach(function(element) {
      if (show) {
        element.classList.remove("hidden")
        element.classList.add("block");
      } else {
        element.classList.remove("block")
        element.classList.add("hidden");
      }
    })
  }

  function toggleScrolling(element, scrollDisabled) {
    var classes = ["scrolling-auto", "overflow-hidden", "fixed", "pin-x"];
    if (scrollDisabled) {
      classes.forEach(function(klass){
        element.classList.add(klass);
      })
    } else {
      classes.forEach(function(klass){
        element.classList.remove(klass);
      })
    }
  }

  var anchors = new AnchorJS();
  anchors.options = {
    placement: 'left'
  }
  anchors.add()
</script>

</html>
